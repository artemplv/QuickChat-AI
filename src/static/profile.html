<!DOCTYPE html>
<html>
<head>
    <title>Messenger — Profile</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="assets/css/style.css" rel="stylesheet">
</head>

<body>
  <div class="profile-view">
    <div class="go-back-section">
      <button class="image-button" type="submit">
        <a href="./chats.html"><img src="assets/images/send-message-icon.svg" alt="options" width="28" height="28" style="transform: rotate(180deg)" /></a>
      </button>
    </div>

    <main>
      <div class="profile-data-wrapper">
        <div class="profile-data">
          <div class="profile-data__avatar">
            <button type="button" class="change-avatar-button" onclick="handleModal('uploadAvatarModal')">
              Поменять<br>аватар
            </button>
          </div>

          <div class="generated-user-data-placeholder"></div>

          <form id="userPassword" class="form profile-data__form" hidden>
            <div class="profile-data__form-item">
              <label for="oldPassword" class="profile-data-form-field__label">Старый пароль</label>
              <input id="oldPassword" name="oldPassword" type="password" class="profile-data-form-field__input" placeholder="пароль" required />
            </div>

            <div class="divider"></div>

            <div class="profile-data__form-item">
              <label for="newPassword" class="profile-data-form-field__label">Новый пароль</label>
              <input id="newPassword" name="newPassword" type="password" class="profile-data-form-field__input" placeholder="пароль" required />
            </div>

            <div class="divider"></div>

            <div class="profile-data__form-item">
              <label for="newPasswordRepeat" class="profile-data-form-field__label">Повторите новый пароль</label>
              <input id="newPasswordRepeat" name="newPasswordRepeat" type="password" class="profile-data-form-field__input" placeholder="пароль" required />
            </div>

            <div class="profile-data__form-controls">
              <button type="submit" class="form__main-button">
                Сохранить
              </button>
              <button type="button" class="profile-data__additional-button" onclick="cancelPasswordChange()">
                Отменить
              </button>
            </div>

          </form>


          <div class="profile-data__control-buttons">
            <button type="button" class="profile-data__additional-button" onclick="onChangeDetailsClick()">
              Изменить данные
            </button>

            <div class="divider"></div>

            <button type="button" class="profile-data__additional-button" onclick="onChangePasswordClick()">
              Изменить пароль
            </button>

            <div class="divider"></div>

            <button type="button" class="profile-data__additional-button logout-button">
              <a class="button-link" href="./login.html">Выйти</a>
            </button>
          </div>

        </div>
      </div>
    </main>
  </div>

  <div id="uploadAvatarModal" class="modal-wrapper">
    <div class="modal-body">
      <h4 class="modal-body__name">Загрузите файл</h4>

      <form id="avatarForm" class="form">
        <div class="file-container">
          <div class="upload-control">
            <label for="avatar" class="avatar-upload-label">Выбрать файл на компьютере</label>
            <input id="avatar" class="avatar-upload-input" name="avatar" type="file" accept=".jpg, .jpeg, .png">
          </div>
          <p class="file-name"></p>
        </div>

        <button type="button" class="form__main-button" onclick="submitAvatar()">
          Поменять
        </button>
      </form>

      <p class="modal-body__error-msg">Нужно выбрать файл</p>
    </div>
  </div>

  <script src="assets/js/generateUser.js"></script>
  <script src="assets/js/handleModal.js"></script>
  <script src="assets/js/handleUserDataButtons.js"></script>
  <script src="assets/js/submitForm.js"></script>
  <script src="assets/js/handleAvatar.js"></script>
  <script>
    userDetails.onsubmit = (e) => {
      e.preventDefault();
      submitForm('userDetails');
      cancelDetailsChange();
    };
    userPassword.onsubmit = (e) => {
      e.preventDefault();
      submitForm('userPassword');
      cancelPasswordChange();
    };

    const avatarInput = document.getElementById('avatar');
    avatarInput.addEventListener('change', handleAvatarUpload);

  </script>

</body>

</html>
